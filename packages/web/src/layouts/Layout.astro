---
import '../styles/custom.css'
import Header from '../components/Header.astro'
import SkipLinks from '../components/SkipLinks.astro'
import SEO from '../components/SEO.astro'

export interface Props {
  title?: string;
  description?: string;
}

const { title = "ocsight - OpenCode Observability", description = "OpenCode observability platform. See everything happening in your OpenCode development." } = Astro.props;
// Canonical URL generation - available for future use
// const canonical = Astro.site ? new URL(Astro.url.pathname, Astro.site).href : undefined;
---

<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content={Astro.generator} />
  <link rel="manifest" href="/manifest.json" />
  <SEO title={title} description={description} />
  <script is:inline>
    const doc = document;
    const root = doc.documentElement;
    const store = globalThis?.localStorage;
    const pref = globalThis?.matchMedia?.('(prefers-color-scheme: dark)');
    const saved = store?.getItem('theme');
    const mode = saved === 'light' || saved === 'dark' ? saved : pref?.matches ? 'dark' : 'light';
    if (mode) {
      root.setAttribute('data-theme', mode);
    }
  </script>
  <script>
    // Register service worker for enhanced caching and offline support
    import { registerServiceWorker } from '../lib/service-worker';
    
    if (typeof window !== 'undefined') {
      registerServiceWorker({
        swPath: '/sw.js',
        scope: '/',
        skipWaiting: true
      });
    }
  </script>
</head>
  <body class="min-h-screen bg-background text-foreground font-mono antialiased">
  <SkipLinks />

  <div class="relative flex min-h-screen flex-col">
    <slot name="header">
      <Header />
    </slot>

    <main id="main-content" role="main">
      <slot />
    </main>

    <slot name="footer"> 
      <footer class="mt-16 border-t border-border py-8">
        <div class="container mx-auto px-4 text-center text-sm text-muted-foreground">
          Â© 2024 ocsight. Built with Astro and Starlight.
        </div>
      </footer>
    </slot>
  </div>
</body>
</html>
